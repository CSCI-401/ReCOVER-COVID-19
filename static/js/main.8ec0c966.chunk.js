(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{451:function(e,t,a){e.exports=a(695)},456:function(e,t,a){},694:function(e,t,a){},695:function(e,t,a){"use strict";a.r(t);var n=a(1),i=a.n(n),r=a(60),s=a.n(r),c=(a(456),a(48)),l=a(44),o=a(126),u=a(124),d=(a(457),a(413)),m=(a(459),a(145)),h=(a(461),a(255)),p=(a(463),a(412)),f=(a(696),a(175)),v=(a(315),a(197)),y=a(191),g=a(192),b=a(198),S=a(108),k=(a(697),a(253)),O=a(72),C=a(385),E=a(202),D=a.n(E),x=a(310),M=a.n(x),j=a(128);var w=function(e){var t=e.series,a=e.lineGenerator,n=e.xScale,r=e.yScale;return t.map((function(e){var t=e.id,s=e.data,c=e.color,l=e.predicted,o=e.distancing,u={strokeWidth:3};return l&&(u.strokeDasharray=o?"6, 4":"2, 6"),i.a.createElement("path",{key:t,d:a(s.map((function(e){return{x:n(e.data.x),y:r(e.data.y)}}))),fill:"none",stroke:c,style:u})}))},A={axis:{ticks:{text:{fontSize:18}},legend:{text:{fontSize:18}}},legends:{text:{fontSize:18}}},P=function(e){Object(o.a)(a,e);var t=Object(u.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"parseDate",value:function(e){var t=e.split("-").map(Number),a=Object(O.a)(t,3),n=a[0],i=a[1],r=a[2];return new Date(n,i-=1,r)}},{key:"getCumulativeData",value:function(e){var t=this;return e.map((function(e){return{x:t.parseDate(e.date),y:e.value}}))}},{key:"getDeltaData",value:function(e,t){var a=this;return e.map((function(n,i){return 0===i?{x:a.parseDate(n.date),y:n.value-t}:{x:a.parseDate(n.date),y:n.value-e[i-1].value}}))}},{key:"processData",value:function(e,t){var a=t.statistic,n=t.yScale,i=t.initialVal,r="delta"===a?this.getDeltaData(e,i):this.getCumulativeData(e);return"log"===n&&(r=r.filter((function(e){e.x;return e.y>0}))),r}},{key:"getDataMax",value:function(){var e=this.props.data,t=0;return Object.keys(e).forEach((function(a){var n=e[a],i=n.observed,r=n.predictions;t=Math.max(t,Math.max.apply(Math,Object(b.a)(i.map((function(e){return e.value}))))),r.forEach((function(e){var a=e.time_series;t=Math.max(t,Math.max.apply(Math,Object(b.a)(a.map((function(e){return e.value})))))}))})),t}},{key:"getYAxisProps",value:function(){for(var e=this.props,t=e.statistic,a=e.yScale,n={format:function(e){return M()(e).format("0.[0]a")},orient:"left",tickSize:5,tickPadding:5,tickRotation:0,legend:"delta"===t?"New Cases":"Cumulative Cases",legendOffset:-60,legendPosition:"middle"},i=[],r=0;r<=Math.ceil(Math.log10(this.getDataMax()));r++)i.push(Math.pow(10,r));var s=Object(g.a)({},n,{tickValues:i});return"log"===a?{axisLeft:s,gridYValues:i,yScale:{type:"log",base:10,min:Math.min.apply(Math,i),max:Math.max.apply(Math,i)}}:{axisLeft:n,yScale:{type:"linear",min:"auto",max:"auto"}}}},{key:"render",value:function(){var e=this,t=this.props.data,a=this.props,n=a.statistic,r=a.yScale,s=[],c=[];Object.keys(t).sort().forEach((function(a,i){var l=function(e){var t=[j.red.primary,j.gold.primary,j.lime.primary,j.cyan.primary,j.geekblue.primary,j.purple.primary,j.magenta.primary];return t[e%t.length]}(i),o=t[a].observed;s.push({id:a,data:e.processData(o,{statistic:n,yScale:r,initialVal:0}),predicted:!1}),c.push(l),t[a].predictions.filter((function(e){return e.time_series.length>0})).forEach((function(t){t.model.name;var i=t.distancing,u=t.time_series;s.push({id:"".concat(a," (").concat(t.model.name,", distancing=").concat(i,")"),data:e.processData(u,{statistic:n,yScale:r,initialVal:o[o.length-1].value}),predicted:!0,distancing:i}),c.push(l)}))}));var l="every week";if(s.length>0){var o=s[0].data[0].x,u=s[0].data[0].x;s.forEach((function(e){e.data.forEach((function(e){var t=e.x;o=Math.min(o,t),u=Math.max(u,t)}))})),o=D()(o),(u=D()(u)).diff(o,"days")>150&&(l="every month")}return i.a.createElement(C.a,Object.assign({data:s,colors:c,margin:{top:50,right:50,bottom:50,left:80},xScale:{type:"time",format:"native",precision:"day"},axisBottom:{tickValues:l,format:function(e){return D()(e).format("M/D")},orient:"bottom",tickSize:5,tickPadding:5,tickRotation:0,legend:"Date",legendOffset:36,legendPosition:"middle"}},this.getYAxisProps(),{enableSlices:"x",sliceTooltip:function(e){var t=e.slice;return i.a.createElement("div",{style:{background:"white",padding:"9px 12px",border:"1px solid #ccc"}},i.a.createElement("div",null,D()(t.points[0].data.x).format("MMM Do YYYY")),t.points.map((function(e){return i.a.createElement("div",{key:e.id,style:{color:e.serieColor,padding:"3px 0"}},i.a.createElement("strong",null,e.serieId),"[",M()(e.data.yFormatted).format("0.[0]a"),"]")})))},pointSize:0,pointLabel:"y",pointLabelYOffset:-12,legends:[{anchor:"top-left",direction:"column",justify:!1,translateX:0,translateY:0,itemsSpacing:0,itemDirection:"left-to-right",itemWidth:80,itemHeight:20,itemOpacity:.75,symbolSize:12,symbolShape:"circle",symbolBorderColor:"rgba(0, 0, 0, .5)",effects:[{on:"hover",style:{itemBackground:"rgba(0, 0, 0, .03)",itemOpacity:1}}]}],layers:["grid","markers","areas","crosshair",w,"slices","points","axes","legends"],theme:A}))}}]),a}(n.Component),I=a(174),B=a.n(I),V="https://dslab-covid19-backend.herokuapp.com/api",R=function(){function e(){Object(c.a)(this,e)}return Object(l.a)(e,[{key:"affected_by",value:function(e){}},{key:"areas",value:function(e){var t="".concat(V,"/areas");B.a.get(t).then((function(t){var a=t.data;console.log(a),e(a)}))}},{key:"models",value:function(e){var t="".concat(V,"/models");B.a.get(t).then((function(t){var a=t.data;console.log(a),e(a)}))}},{key:"cumulative_infections",value:function(e){var t="".concat(V,"/cumulative_infections");B.a.get(t).then((function(t){return e(t.data)}))}},{key:"predict_all",value:function(e,t){var a="".concat(V,"/predict_all");B.a.get(a,{params:e}).then((function(e){return t(e.data)}))}},{key:"predict",value:function(e,t){var a="".concat(V,"/predict");console.log(e),B.a.get(a,{params:e}).then((function(e){t(e.data)}))}}]),e}();function G(e){return"".concat(e.country).concat(e.state?" / "+e.state:"")}var L=a(98),_=a(203),Y=a(311),N=a(312),T=a(398),z=a(399),W=a(400),q=a(414);L.e(q.a);var F=function(e){Object(o.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(c.a)(this,a),(e=t.call(this)).modelAPI=new R,e.modelAPI.areas((function(t){return e.setState({areasList:t})})),e}return Object(l.a)(a,[{key:"componentDidMount",value:function(){this.props.triggerRef(this),this.fetchData(this.props.dynamicMapOn)}},{key:"fetchData",value:function(e){var t=this;e&&""!==this.props.model?this.modelAPI.predict_all({days:this.props.days,model:this.props.model},(function(e){var a=e.map((function(e){return{id:e.area.iso_2,value:e.value>0?Math.log(e.value):0,valueTrue:e.value,area:e.area}}));t.setState({heatmapData:a},t.resetChart)})):this.modelAPI.cumulative_infections((function(e){var a=e.map((function(e){return{id:e.area.iso_2,value:e.value>0?Math.log(e.value):0,valueTrue:e.value,area:e.area}}));t.setState({heatmapData:a},t.createChart)}))}},{key:"initChart",value:function(){this.chart=L.d("chartdiv",_.a),this.chart.projection=new _.d.Mercator}},{key:"createChartSeries",value:function(e){var t=this.chart.series.push(new _.b),a=(t=Object.assign(t,e)).mapPolygons.template;t.heatRules.push({property:"fill",target:a,min:L.c("#fcbba0"),max:L.c("#66000d"),maxValue:Math.log(5e6)}),a.tooltipText="{name}: {valueTrue}",a.nonScalingStroke=!0,a.strokeWidth=.5,a.states.create("hover").properties.fill=L.c("#e43027"),a.cursorOverStyle=L.b.pointer;var n=this.props.onMapClick;return a.events.on("hit",(function(e){var t=e.target.dataItem.dataContext,a=(t.id,t.value,t.area);n(a)})),t}},{key:"initChartInterface",value:function(){var e=this;this.chart.zoomControl=new _.c,this.chart.zoomControl.cursorOverStyle=L.b.pointer;var t=this.chart.chartContainer.createChild(L.a);t.label.text="Show States/Provinces",t.togglable=!0,t.padding(5,5,5,5),t.align="right",t.marginRight=15,t.cursorOverStyle=L.b.pointer,t.events.on("hit",(function(){e.stateSeries.forEach((function(e){return e.disabled=!t.isActive})),t.label.text="".concat(t.isActive?"Hide":"Show"," States/Provinces")}))}},{key:"createChart",value:function(){var e=this.state.heatmapData;this.initChart();this.createChartSeries({geodata:Y.a,exclude:["AQ"],data:e});var t=this.createChartSeries({geodata:T.a,data:e,disabled:!0}),a=this.createChartSeries({geodata:N.a,data:e,disabled:!0}),n=this.createChartSeries({geodata:z.a,data:e,disabled:!0}),i=this.createChartSeries({geodata:W.a,data:e,disabled:!0});this.stateSeries=[t,a,n,i],this.initChartInterface()}},{key:"resetChart",value:function(){var e=this.state.heatmapData,t=(this.createChartSeries({geodata:Y.a,exclude:["AQ"],data:e}),this.createChartSeries({geodata:N.a,data:e,disabled:!0}));this.stateSeries=[t]}},{key:"componentWillUnmount",value:function(){this.chart&&this.chart.dispose()}},{key:"render",value:function(){return i.a.createElement("div",{id:"chartdiv"})}}]),a}(n.Component),H=k.a.Option,J=function(e){Object(o.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleYScaleSelect=function(e){n.setState({yScale:e.target.value})},n.handleStatisticSelect=function(e){n.setState({statistic:e.target.value})},n.bindRef=function(e){n.map=e},n.formRef=i.a.createRef(),n.modelAPI=new R,n.modelAPI.areas((function(e){return n.setState({areasList:e})})),n.modelAPI.models((function(e){return n.setState({modelsList:e})})),n.state={areas:n.props.areas||[],areasList:[],models:n.props.models||[],modelsList:[],distancingOn:!0,distancingOff:!1,mainGraphData:{},days:10,dynamicMapOn:!1,statistic:"cumulative",yScale:"linear"},n.addAreaByStr=n.addAreaByStr.bind(Object(S.a)(n)),n.removeAreaByStr=n.removeAreaByStr.bind(Object(S.a)(n)),n.onValuesChange=n.onValuesChange.bind(Object(S.a)(n)),n.onMapClick=n.onMapClick.bind(Object(S.a)(n)),n.onDaysToPredictChange=n.onDaysToPredictChange.bind(Object(S.a)(n)),n.switchDynamicMap=n.switchDynamicMap.bind(Object(S.a)(n)),n}return Object(l.a)(a,[{key:"onMapClick",value:function(e){this.areaIsSelected(e)||this.addAreaByStr(G(e))}},{key:"areaIsSelected",value:function(e){if(this.state.areas&&e){var t=G(e);return this.state.areas.includes(t)}return!1}},{key:"addAreaByStr",value:function(e){var t=this,a=function(e){var t=e.split("/");return{country:t[0].trim(),state:2===t.length?t[1].trim():""}}(e);this.setState((function(t){return{areas:[].concat(Object(b.a)(t.areas),[e])}}),(function(){t.modelAPI.predict({state:a.state,country:a.country,models:t.state.models,days:t.state.days,distancingOn:t.state.distancingOn,distancingOff:t.state.distancingOff},(function(a){t.setState((function(t){return{mainGraphData:Object(g.a)({},t.mainGraphData,Object(y.a)({},e,a))}}))})),t.formRef.current.setFieldsValue({areas:t.state.areas})}))}},{key:"removeAreaByStr",value:function(e){this.setState((function(t){return{areas:t.areas.filter((function(t){return t!==e})),mainGraphData:Object.keys(t.mainGraphData).filter((function(t){return t!=e})).reduce((function(e,a){return Object(g.a)({},e,Object(y.a)({},a,t.mainGraphData[a]))}),{})}}))}},{key:"modelIsSelected",value:function(e){if(this.state.models&&e){var t="".concat(e.name);return this.state.models.includes(t)}return!1}},{key:"onValuesChange",value:function(e,t){var a=this;if("socialDistancing"in e||"models"in e)this.setState({models:t.models,distancingOn:t.socialDistancing.includes("distancingOn"),distancingOff:t.socialDistancing.includes("distancingOff")},(function(){a.reloadAll()}));else{var n=this.state.areas,i=t.areas,r=i.filter((function(e){return!n.includes(e)})),s=n.filter((function(e){return!i.includes(e)}));r.forEach(this.addAreaByStr),s.forEach(this.removeAreaByStr)}}},{key:"onDaysToPredictChange",value:function(e){var t=this;this.state.areas;this.setState({days:e},(function(){t.reloadAll()}))}},{key:"reloadAll",value:function(){var e=this,t=this.state.areas;this.setState({areas:[],mainGraphData:{}},(function(){t.forEach(e.addAreaByStr),e.state.dynamicMapOn&&0!==e.state.models.length&&e.map.fetchData(e.state.dynamicMapOn)}))}},{key:"switchDynamicMap",value:function(e){this.setState({dynamicMapOn:e}),this.map.fetchData(e)}},{key:"render",value:function(){var e=this,t=this.state,a=t.areas,n=t.areasList,r=t.modelsList,s=t.days,c=t.mainGraphData,l=(t.dynamicMapOn,t.statistic),o=t.yScale,u=n.filter((function(t){return!e.areaIsSelected(t)})).map(G).sort().map((function(e){return i.a.createElement(H,{key:e}," ",e," ")})),y=r.filter((function(t){return!e.modelIsSelected(t)})).map((function(e){return i.a.createElement(H,{key:e.name},i.a.createElement(v.a,{title:e.description,placement:"right"},e.name))}));return i.a.createElement("div",{className:"covid-19-predict"},i.a.createElement("div",{className:"left-col"},i.a.createElement("div",{className:"form-wrapper"},i.a.createElement(f.a,{ref:this.formRef,onValuesChange:this.onValuesChange,initialValues:{areas:a,days:10,socialDistancing:["distancingOn"]}},i.a.createElement(f.a.Item,{label:"Areas",name:"areas",rules:[{required:!0,message:"Please select areas!"}]},i.a.createElement(k.a,{mode:"multiple",style:{width:"100%"},placeholder:"Select Areas"},u)),i.a.createElement(f.a.Item,{label:"Under-reporting Cases:",name:"models",rules:[{required:!0,message:"Please select reporting ratio!"}]},i.a.createElement(k.a,{mode:"multiple",style:{width:"100%"},placeholder:"Select Reporting Ratio"},y)),i.a.createElement(f.a.Item,{label:"Days to Predict",name:"days",rules:[{required:!0,message:"Please select number of days!"}]},i.a.createElement(p.a,{min:0,initialValue:15,max:99,onAfterChange:this.onDaysToPredictChange})),i.a.createElement(v.a,{title:'The trend until March 18th has been used as a proxy for "Social distancing off".  For modeling details, please see: https://arxiv.org/abs/2004.11372',placement:"topLeft"},i.a.createElement(f.a.Item,{label:"Social Distancing",name:"socialDistancing"},i.a.createElement(h.a.Group,null,i.a.createElement(h.a,{defaultChecked:!0,value:"distancingOn"},"On"),i.a.createElement(h.a,{value:"distancingOff"},"Off"))))),i.a.createElement("div",null,"Statistic:\xa0\xa0",i.a.createElement(m.a.Group,{value:l,onChange:this.handleStatisticSelect},i.a.createElement(m.a,{value:"cumulative"},"Cumulative Cases"),i.a.createElement(m.a,{value:"delta"},"New Cases"))),i.a.createElement("br",null),i.a.createElement("div",null,"Scale:\xa0\xa0",i.a.createElement(m.a.Group,{value:o,onChange:this.handleYScaleSelect},i.a.createElement(m.a,{value:"linear"},"linear"),i.a.createElement(m.a,{value:"log"},"logarithmic"))),i.a.createElement("br",null),i.a.createElement("p",null,"Dynamic Map:\xa0\xa0",i.a.createElement(d.a,{onChange:this.switchDynamicMap}))),i.a.createElement("div",{className:"map-wrapper"},i.a.createElement(F,{triggerRef:this.bindRef,dynamicMapOn:this.state.dynamicMapOn,days:s,model:null==this.state.models||0===this.state.models.length?"":this.state.models[this.state.models.length-1],onMapClick:this.onMapClick}))),i.a.createElement("div",{className:"right-col"},i.a.createElement("div",{className:"graph-wrapper"},i.a.createElement(P,{data:c,statistic:l,yScale:o}))))}}]),a}(n.PureComponent),Q=(a(694),function(e){Object(o.a)(a,e);var t=Object(u.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return i.a.createElement("div",{className:"app-wrapper"},i.a.createElement(J,null))}}]),a}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(i.a.createElement(Q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[451,1,3]]]);
//# sourceMappingURL=main.8ec0c966.chunk.js.map